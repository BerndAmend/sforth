<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<script>sforthThrowOnUnderflow=false</script>
	<script src="../ext/jquery-2.1.0.min.js"></script>
	<script src="../sforth-runtime.js"></script>
	<script src="../sforth.js"></script>
</head>
<body>
	<script data-src="../forth.fs;../browser.fs" type="application/sforth"></script>

	<input id="message" type="text" size="30" maxlength="30">
	<input type="button" value="Send" onclick="sendMessage()">
	<div id="log"></div>

	<script type="application/sforth" data-id="worker1" data-type="javascript/worker"
		data-src="../sforth-runtime.js;../forth.fs" data-throw-on-underflow="false">
		:jsnoname { e } 
			»msg from worker, got « e.data + self.postMessage(1)
		; to self.onmessage
	</script>

	<script type="application/sforth">
		:js sendMessage {}
			"message document.getElementById(1) { msg }
			msg.value worker.postMessage(1)
		;

		: log { msg }
			document.createDocumentFragment(0) { fragment }
			msg document.createTextNode(1) fragment.appendChild(1)
			"br document.createElement(1) fragment.appendChild(1)
			"#log document.querySelector(1) { node } fragment node.appendChild(1)
		;

		"#worker1 create-worker { worker }

		:jsnoname { e }
			»Received: « e.data + log
		; to worker.onmessage

		"Hi worker.postMessage
	</script>
</body>
</html>